# Claude Code + Mise + Veloera å®Œæ•´è§£å†³æ–¹æ¡ˆ

## ğŸ¯ æœ€ç»ˆé€‰å‹

**ä¸»è¦æ¶æ„**: Claude Code CLI + Mise + Veloera
**å¤‡é€‰æ–¹æ¡ˆ**: Claude Code + CCR + Veloera (éœ€è¦å¤šé…ç½®æ–‡ä»¶åˆ‡æ¢)

## 2. æ ¸å¿ƒæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Veloera (Provideræ±‡é›†å±‚)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  BigGLM API    â”‚  â”‚ BigGLM Coding  â”‚  â”‚ DeepSeek API â”‚ â”‚
â”‚  â”‚  (glm-4.6)     â”‚  â”‚  (è®¡è´¹è®¡åˆ’)     â”‚  â”‚ (deepseek)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚   Kimi API      â”‚  â”‚   å…¶ä»–Provider  â”‚                   â”‚
â”‚  â”‚  (moonshot)     â”‚  â”‚                 â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ ç»Ÿä¸€OpenAIå…¼å®¹API
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Mise (é¡¹ç›®ç®¡ç†å±‚)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å¼€å‘é¡¹ç›® â”‚  â”‚  å†…å®¹åˆ›ä½œé¡¹ç›®â”‚  â”‚   æ•°æ®åˆ†æé¡¹ç›®      â”‚   â”‚
â”‚  â”‚ glm-4.6     â”‚  â”‚  glm-4.5     â”‚  â”‚     glm-4.6        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                           â”‚
â”‚  â”‚  ç»æµæ¨¡å¼é¡¹ç›®â”‚  â”‚  å…¶ä»–è‡ªå®šä¹‰é¡¹ç›®â”‚                         â”‚
â”‚  â”‚  kimi       â”‚  â”‚   è‡ªå®šä¹‰é…ç½®   â”‚                         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚ ç¯å¢ƒå˜é‡åˆ‡æ¢
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Claude Code CLI (å·¥å…·å±‚)                  â”‚
â”‚                                                           â”‚
â”‚  claude "å†™ä¸€ä¸ªReactç»„ä»¶"                                   â”‚
â”‚  claude "åˆ†æè¿™ä¸ªæ•°æ®é›†"                                     â”‚
â”‚  claude "å†™ä¸€ç¯‡æŠ€æœ¯æ–‡æ¡£"                                     â”‚
â”‚                                                           â”‚
â”‚  é€šè¿‡ç¯å¢ƒå˜é‡è‡ªåŠ¨ä½¿ç”¨é¡¹ç›®çš„AIé…ç½®                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 3. é…ç½®ä½“ç³»è®¾è®¡

### 3.1 Veloeraéƒ¨ç½²é…ç½®

```yaml
# docker-compose.yml
services:
  veloera:
    restart: unless-stopped
    image: ghcr.io/veloera/veloera:latest
    env_file: .env
    container_name: veloera
    ports:
      - "3000:3000"
    volumes:
      - ./data:/data
    environment:
      - TZ=Asia/Shanghai
```

### 3.2 Mise é¡¹ç›®çº§é…ç½®

#### å¼€å‘é¡¹ç›® (.mise.toml)
```toml
[env]
# Veloeraé…ç½®
VELOERA_TOKEN = "your-veloera-token"
VELOERA_ANTHROPIC_URL = "http://localhost:3000/v1"

# Claude Codeé…ç½®
ANTHROPIC_AUTH_TOKEN = "{{ env.VELOERA_TOKEN }}"
ANTHROPIC_BASE_URL = "{{ env.VELOERA_ANTHROPIC_URL }}"
CLAUDE_MODEL = "glm-4.6"
```

#### å†…å®¹åˆ›ä½œé¡¹ç›® (.mise.toml)
```toml
[env]
# Veloeraé…ç½®
VELOERA_TOKEN = "your-veloera-token"
VELOERA_ANTHROPIC_URL = "http://localhost:3000/v1"

# Claude Codeé…ç½®
ANTHROPIC_AUTH_TOKEN = "{{ env.VELOERA_TOKEN }}"
ANTHROPIC_BASE_URL = "{{ env.VELOERA_ANTHROPIC_URL }}"
CLAUDE_MODEL = "glm-4.5"
```

## 4. è‡ªåŠ¨åˆ‡æ¢å®ç°

### 4.1 ç›®å½•æ£€æµ‹è„šæœ¬
```bash
#!/usr/bin/env bash
# ~/.local/bin/auto-switch-ai

detect_project_type() {
  local dir="$1"

  # æ£€æµ‹package.jsonä¸­çš„ä¾èµ–
  if [[ -f "$dir/package.json" ]]; then
    if grep -q "react\|vue\|angular" "$dir/package.json"; then
      echo "development"
      return
    fi
  fi

  # æ£€æµ‹READMEå†…å®¹
  if [[ -f "$dir/README.md" ]]; then
    if grep -q "docs\|documentation\|tutorial" "$dir/README.md"; then
      echo "content_creation"
      return
    fi
  fi

  # æ£€æµ‹æ•°æ®åˆ†ææ–‡ä»¶
  if ls "$dir"/*.csv "$dir"/*.json "$dir"/*.ipynb >/dev/null 2>&1; then
    echo "data_analysis"
    return
  fi

  # é»˜è®¤é…ç½®
  echo "general"
}

# ä¸»é€»è¾‘
current_dir="$(pwd)"
project_type="$(detect_project_type "$current_dir")"

echo "ğŸ”„ æ£€æµ‹åˆ°é¡¹ç›®ç±»å‹: $project_type"
echo "âœ… å·²åˆ‡æ¢åˆ° $project_type é…ç½®"
```

### 4.2 Shellé›†æˆ
```bash
# ~/.zshrc æˆ– ~/.bashrc
# æ·»åŠ cd hook
autoload -U add-zsh-hook 2>/dev/null || true

auto_switch_ai() {
  if [[ -f ".mise.toml" ]] && command -v auto-switch-ai >/dev/null; then
    auto-switch-ai
  fi
}

# Zsh hook
if command -v add-zsh-hook >/dev/null; then
  add-zsh-hook chpwd auto_switch_ai
else
  # Bash fallback
  cd() {
    builtin cd "$@" && auto_switch_ai
  }
fi
```

## 5. å·¥ä½œæµç¨‹

### 5.1 åˆå§‹è®¾ç½®
```bash
# 1. éƒ¨ç½²Veloera
docker-compose up -d

# 2. é…ç½®Provider
# é€šè¿‡Webç•Œé¢é…ç½®Provider

# 3. é…ç½®Miseå…¨å±€ç¯å¢ƒ
mise settings set experimental true
mise install
```

### 5.2 é¡¹ç›®ä½¿ç”¨
```bash
# è¿›å…¥é¡¹ç›®ç›®å½• (è‡ªåŠ¨åˆ‡æ¢)
cd ~/projects/my-web-app
# â†’ è‡ªåŠ¨æ£€æµ‹å¹¶åˆ‡æ¢åˆ°developmenté…ç½®

# æŸ¥çœ‹å½“å‰çŠ¶æ€
mise env | grep -E "(CLAUDE_MODEL|ANTHROPIC)"

# ä½¿ç”¨Claude Code
claude "å¸®æˆ‘å®ç°ä¸€ä¸ªç”¨æˆ·ç™»å½•ç»„ä»¶"
```

## 6. é«˜çº§åŠŸèƒ½

### 6.1 é…ç½®éªŒè¯
```bash
#!/usr/bin/env bash
# scripts/validate-ai-config.sh

validate_config() {
    local config_file=".mise.toml"

    if [[ ! -f "$config_file" ]]; then
        echo "âŒ é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: $config_file"
        return 1
    fi

    # éªŒè¯å¿…è¦å­—æ®µ
    if ! grep -q "CLAUDE_MODEL" "$config_file"; then
        echo "âŒ ç¼ºå°‘CLAUDE_MODELé…ç½®"
        return 1
    fi

    echo "âœ… é…ç½®éªŒè¯é€šè¿‡"
    return 0
}

validate_config
```

### 6.2 å›¢é˜Ÿé…ç½®åŒæ­¥
```bash
#!/usr/bin/env bash
# scripts/sync-ai-configs.sh

# ä»è¿œç¨‹ä»“åº“åŒæ­¥é…ç½®æ¨¡æ¿
git clone https://github.com/your-org/ai-configs.git ~/.mise/templates

# æ›´æ–°æœ¬åœ°é…ç½®
for profile in dev content data-analysis; do
    if [[ -f ~/.mise/templates/$profile/.mise.toml ]]; then
        cp ~/.mise/templates/$profile/.mise.toml ./
        echo "âœ… å·²æ›´æ–°é…ç½®: $profile"
    fi
done
```

## 7. æ•…éšœæ’æŸ¥

### 7.1 å¸¸è§é—®é¢˜
```bash
# æ£€æŸ¥é…ç½®
mise env | grep -E "(VELOERA|ANTHROPIC)"
cat .mise.toml

# æ£€æŸ¥VeloeraçŠ¶æ€
docker-compose ps
curl -s "http://localhost:3000/health"
```

### 7.2 è°ƒè¯•æ¨¡å¼
```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
export CLAUDE_DEBUG=1

# æµ‹è¯•é…ç½®åŠ è½½
mise env
```

## 8. æœ€ä½³å®è·µ

1. **é…ç½®å‘½åè§„èŒƒ**: ä½¿ç”¨æè¿°æ€§çš„é¡¹ç›®ç±»å‹åç§°
2. **ç¯å¢ƒå˜é‡ç®¡ç†**: æ•æ„Ÿä¿¡æ¯é€šè¿‡Miseç®¡ç†
3. **ç‰ˆæœ¬æ§åˆ¶**: é…ç½®æ¨¡æ¿çº³å…¥ç‰ˆæœ¬æ§åˆ¶
4. **æ–‡æ¡£ç»´æŠ¤**: ä¸ºæ¯ä¸ªé…ç½®ç¼–å†™ä½¿ç”¨è¯´æ˜
5. **å®šæœŸå¤‡ä»½**: å®šæœŸå¤‡ä»½é…ç½®æ•°æ®

## 9. æ€»ç»“

è¿™ä¸ªæ–¹æ¡ˆé€šè¿‡ **Claude Code CLI + Mise + Veloera** çš„ç»„åˆï¼Œå®ç°äº†ï¼š

- âœ… **è‡ªåŠ¨åŒ–é…ç½®åˆ‡æ¢**: åŸºäºé¡¹ç›®ç›®å½•è‡ªåŠ¨åº”ç”¨é¡¹ç›®é…ç½®
- âœ… **é¡¹ç›®çº§éš”ç¦»**: ä¸åŒé¡¹ç›®ä½¿ç”¨ç‹¬ç«‹çš„é…ç½®å’Œç¯å¢ƒ
- âœ… **ç®€åŒ–ç®¡ç†**: ç»Ÿä¸€çš„é…ç½®ç®¡ç†å·¥å…·
- âœ… **å›¢é˜Ÿåä½œ**: æ”¯æŒé…ç½®åŒæ­¥å’Œæ ‡å‡†åŒ–
- âœ… **æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°çš„é…ç½®ç±»å‹å’ŒåŠŸèƒ½

ç›¸æ¯”å¤æ‚çš„å¤šå·¥å…·æ–¹æ¡ˆï¼Œè¿™ä¸ªæ¶æ„æ›´ç®€å•ã€æ›´æ˜“ç»´æŠ¤ï¼ŒåŒæ—¶æ»¡è¶³å¤§å¤šæ•°å®é™…ä½¿ç”¨åœºæ™¯ã€‚